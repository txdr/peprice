<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeptideClub — Price Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f7f9fc;
            --surface: #ffffff;
            --surface2: #f0f4f8;
            --border: rgba(0,0,0,0.07);
            --text: #0d1117;
            --muted: #8a9ab0;
            --accent: #3b82f6;
            --accent-glow: rgba(59,130,246,0.18);
            --orange: #ff7220;
            --orange-glow: rgba(255,114,32,0.22);
            --green: #22c55e;
            --green-glow: rgba(34,197,94,0.15);
            --radius: 16px;
            --radius-sm: 10px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'DM Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Soft bg blobs */
        body::before {
            content: '';
            position: fixed;
            top: -200px; left: -200px;
            width: 700px; height: 700px;
            background: radial-gradient(circle, rgba(59,130,246,0.09) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }
        body::after {
            content: '';
            position: fixed;
            bottom: -150px; right: -150px;
            width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(255,114,32,0.07) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        header {
            position: relative; z-index: 10;
            padding: 52px 40px 36px;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 20px;
        }

        .header-title {
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: clamp(28px, 4vw, 42px);
            letter-spacing: -1px;
            line-height: 1;
            color: var(--text);
        }
        .header-title span {
            color: var(--accent);
            text-shadow: 0 0 24px var(--accent-glow);
        }

        .header-sub {
            font-size: 11px;
            color: var(--muted);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 8px;
        }

        .last-updated-tag {
            font-size: 10px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 6px 14px;
            color: var(--muted);
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        /* Main content */
        main {
            position: relative; z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px 80px;
            display: flex;
            flex-direction: column;
            gap: 48px;
        }

        /* Peptide section */
        .peptide-section {}

        .peptide-label {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 20px;
            letter-spacing: -0.5px;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .peptide-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* Cards grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        /* Card */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.04), 0 1px 4px rgba(0,0,0,0.04);
            transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            box-shadow: 0 8px 40px rgba(59,130,246,0.10), 0 2px 8px rgba(0,0,0,0.06);
            transform: translateY(-2px);
            border-color: rgba(59,130,246,0.18);
        }

        /* Best price badge */
        .best-badge {
            position: absolute;
            top: 16px; right: 16px;
            background: var(--green);
            color: #fff;
            font-size: 9px;
            font-weight: 500;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            padding: 4px 10px;
            border-radius: 20px;
            box-shadow: 0 0 12px var(--green-glow), 0 2px 8px rgba(34,197,94,0.25);
        }

        /* Card header */
        .card-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 20px;
        }

        .vendor-logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: contain;
            background: var(--surface2);
            border: 1px solid var(--border);
            padding: 4px;
            flex-shrink: 0;
        }

        .vendor-name {
            font-family: 'Syne', sans-serif;
            font-weight: 600;
            font-size: 15px;
            line-height: 1.2;
        }
        .vendor-peptide {
            font-size: 11px;
            color: var(--muted);
            margin-top: 2px;
        }

        /* Sizes table */
        .sizes-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 18px;
        }
        .sizes-table th {
            font-size: 9px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--muted);
            padding: 0 0 8px;
            text-align: left;
            font-weight: 400;
        }
        .sizes-table th:last-child { text-align: right; }
        .sizes-table td {
            padding: 7px 0;
            font-size: 13px;
            border-top: 1px solid var(--border);
        }
        .sizes-table td:last-child { text-align: right; }

        .size-tag {
            display: inline-block;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 2px 8px;
            font-size: 11px;
            color: var(--text);
            letter-spacing: 0.04em;
        }

        .price-per-mg {
            font-weight: 500;
            color: var(--accent);
            text-shadow: 0 0 14px var(--accent-glow);
        }

        .best-row td { background: rgba(59,130,246,0.04); }
        .best-row .price-per-mg {
            color: var(--green);
            text-shadow: 0 0 14px var(--green-glow);
        }

        .note-text {
            font-size: 10px;
            color: var(--muted);
            font-style: italic;
        }

        /* Shop row */
        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 4px;
        }

        .discount-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
        }
        .discount-code {
            font-weight: 500;
            letter-spacing: 0.08em;
            color: var(--orange);
            text-shadow: 0 0 10px var(--orange-glow), 0 0 20px var(--orange-glow);
            background: rgba(255,114,32,0.08);
            border: 1px solid rgba(255,114,32,0.25);
            border-radius: 6px;
            padding: 3px 8px;
        }
        .discount-pct {
            font-size: 11px;
            color: var(--orange);
            text-shadow: 0 0 8px var(--orange-glow);
            font-weight: 500;
        }

        .shop-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--accent);
            color: #fff;
            font-family: 'DM Mono', monospace;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            text-decoration: none;
            padding: 9px 18px;
            border-radius: 8px;
            box-shadow: 0 0 18px var(--accent-glow), 0 2px 8px rgba(59,130,246,0.2);
            transition: box-shadow 0.15s, transform 0.15s, background 0.15s;
            white-space: nowrap;
        }
        .shop-btn:hover {
            background: #2563eb;
            box-shadow: 0 0 28px rgba(59,130,246,0.3), 0 4px 12px rgba(59,130,246,0.25);
            transform: translateY(-1px);
        }
        .shop-btn svg {
            width: 12px; height: 12px;
            stroke: currentColor; fill: none; stroke-width: 2;
            stroke-linecap: round; stroke-linejoin: round;
        }

        /* Stale indicator */
        .stale-dot {
            display: inline-block;
            width: 6px; height: 6px;
            border-radius: 50%;
            background: var(--muted);
            margin-right: 4px;
            vertical-align: middle;
        }
        .fresh-dot {
            background: var(--green);
            box-shadow: 0 0 6px var(--green-glow);
        }

        @media (max-width: 600px) {
            header, main { padding-left: 20px; padding-right: 20px; }
            header { flex-direction: column; align-items: flex-start; }
        }

        /* Entrance animation */
        .card {
            animation: fadeUp 0.4s ease both;
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<header>
    <div>
        <div class="header-title">Peptide<span>Club</span></div>
        <div class="header-sub">Research Compound Price Tracker</div>
    </div>
    <div class="last-updated-tag" id="last-updated-tag">Loading prices…</div>
</header>

<main id="app"></main>

<script>
    const DATA_URL = 'data.json';

    function formatDate(ts) {
        const d = new Date(ts * 1000);
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function daysAgo(ts) {
        return Math.floor((Date.now() - ts * 1000) / 86400000);
    }

    function parseSize(sizeStr) {
        return parseFloat(sizeStr); // e.g. "50mg" -> 50
    }

    function pricePerMg(pricePerML, sizeStr) {
        const mg = parseSize(sizeStr);
        if (!mg) return null;
        return pricePerML / mg;
    }

    async function load() {
        let data;
        try {
            const res = await fetch(DATA_URL);
            data = await res.json();
        } catch(e) {
            // Inline fallback data for demo purposes
            data = {"icons":{"PeptideSciences":{"url":"https://i.ibb.co/VcmW0fyc/image.png","affiliateCode":"CLUB","discount":"35%"},"OnyxResearch":{"url":"https://i.ibb.co/RT9QJFJz/image.png","affiliateCode":"CLUB","discount":"42%"},"NuSciencePeptides":{"url":"https://i.ibb.co/bM1KZSWR/image.png","affiliateCode":"CLUB","discount":"31%"},"AminoClub":{"url":"https://i.ibb.co/Ps1grgRw/image.png","affiliateCode":"CLUB","discount":"20%"}},"peptides":{"GHK-Cu":[{"name":"PeptideSciences","sizes":{"50mg":{"pricePerML":1.4,"note":"More $ taken off for very lage purchases."}},"url":"https://www.peptidesciences.com/ghk-cu-50mg-copper-peptide","lastUpdated":1769731200},{"name":"AminoClub","sizes":{"50mg":{"pricePerML":1.47},"100mg":{"pricePerML":1.56}},"url":"https://aminoclub.com?utm_source=affiliate_marketing&code=CLUB","lastUpdated":1769731200},{"name":"NuSciencePeptides","sizes":{"50mg":{"pricePerML":0.89},"100mg":{"pricePerML":0.79}},"url":"https://nusciencepeptides.com/product/ghk-cu/","lastUpdated":1769731200}],"GLP-3-RT":[{"name":"Onyx Research","sizes":{"10mg":{"pricePerML":8.50},"20mg":{"pricePerML":7.75},"30mg":{"pricePerML":6.30},"60mg":{"pricePerML":4.66}},"url":"https://onyxresearch.shop/product/glp-3-rt/","lastUpdated":1768902480},{"name":"NuSciencePeptides","sizes":{"5mg":{"pricePerML":17.80},"10mg":{"pricePerML":13.90},"20mg":{"pricePerML":11.45},"30mg":{"pricePerML":9.60},"40mg":{"pricePerML":9.96}},"url":"https://nusciencepeptides.com/product/glp-3-rt/","lastUpdated":1767902480}]}};
        }
        render(data);
    }

    function getIconInfo(name, icons) {
        // Try exact match first, then loose
        if (icons[name]) return icons[name];
        const key = Object.keys(icons).find(k => k.toLowerCase().replace(/\s/g,'') === name.toLowerCase().replace(/\s/g,''));
        return key ? icons[key] : null;
    }

    function render(data) {
        const app = document.getElementById('app');
        const icons = data.icons;
        const peptides = data.peptides;

        // Find global best price/mg for badge
        // Per peptide, compute all price/mg values, find min
        const peptideNames = Object.keys(peptides);

        // Update last updated
        let allTimestamps = [];
        peptideNames.forEach(p => peptides[p].forEach(v => { if(v.lastUpdated) allTimestamps.push(v.lastUpdated); }));
        const latestTs = Math.max(...allTimestamps);
        document.getElementById('last-updated-tag').textContent = `Updated ${formatDate(latestTs)}`;

        peptideNames.forEach((peptideName, pi) => {
            const vendors = peptides[peptideName];

            // Compute all price/mg values to find global best for this peptide
            let allPricesPerMg = [];
            vendors.forEach(v => {
                Object.entries(v.sizes).forEach(([size, info]) => {
                    const p = pricePerMg(info.pricePerML, size);
                    if (p != null) allPricesPerMg.push(p);
                });
            });
            const bestPricePerMg = Math.min(...allPricesPerMg);

            const section = document.createElement('div');
            section.className = 'peptide-section';
            section.style.animationDelay = `${pi * 0.08}s`;

            const label = document.createElement('div');
            label.className = 'peptide-label';
            label.textContent = peptideName;
            section.appendChild(label);

            const grid = document.createElement('div');
            grid.className = 'cards-grid';

            vendors.forEach((vendor, vi) => {
                const iconInfo = getIconInfo(vendor.name, icons);
                const isBestVendor = Object.entries(vendor.sizes).some(([size, info]) => {
                    const p = pricePerMg(info.pricePerML, size);
                    return Math.abs(p - bestPricePerMg) < 0.0001;
                });

                const card = document.createElement('div');
                card.className = 'card';
                card.style.animationDelay = `${pi * 0.08 + vi * 0.06}s`;

                let html = '';

                if (isBestVendor) {
                    html += `<div class="best-badge">Best Price</div>`;
                }

                // Header
                const logoSrc = iconInfo ? iconInfo.url : '';
                html += `<div class="card-header">`;
                if (logoSrc) {
                    html += `<img class="vendor-logo" src="${logoSrc}" alt="${vendor.name}" onerror="this.style.display='none'">`;
                }
                html += `<div>
        <div class="vendor-name">${vendor.name}</div>
        <div class="vendor-peptide">
          <span class="${daysAgo(vendor.lastUpdated) < 14 ? 'fresh-dot' : 'stale-dot'} stale-dot"></span>
          ${formatDate(vendor.lastUpdated)}
        </div>
      </div></div>`;

                // Sizes table
                html += `<table class="sizes-table">
        <thead><tr>
          <th>Size</th>
          <th>$/mL</th>
          <th>$/mg</th>
        </tr></thead>
        <tbody>`;

                Object.entries(vendor.sizes).forEach(([size, info]) => {
                    const ppm = pricePerMg(info.pricePerML, size);
                    const isBestRow = Math.abs(ppm - bestPricePerMg) < 0.0001;
                    html += `<tr class="${isBestRow ? 'best-row' : ''}">
          <td><span class="size-tag">${size}</span></td>
          <td>$${info.pricePerML.toFixed(2)}</td>
          <td><span class="price-per-mg">$${ppm.toFixed(3)}</span></td>
        </tr>`;
                    if (info.note) {
                        html += `<tr><td colspan="3" class="note-text">${info.note}</td></tr>`;
                    }
                });

                html += `</tbody></table>`;

                // Footer
                html += `<div class="card-footer">`;
                if (iconInfo) {
                    html += `<div class="discount-tag">
          <span class="discount-code">${iconInfo.affiliateCode}</span>
          <span class="discount-pct">${iconInfo.discount} off</span>
        </div>`;
                }
                html += `<a class="shop-btn" href="${vendor.url}" target="_blank" rel="noopener">
        Shop
        <svg viewBox="0 0 24 24"><path d="M7 17L17 7M7 7h10v10"/></svg>
      </a>`;
                html += `</div>`;

                card.innerHTML = html;
                grid.appendChild(card);
            });

            section.appendChild(grid);
            app.appendChild(section);
        });
    }

    load();
</script>
</body>
</html>
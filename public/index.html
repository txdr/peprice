<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peptide Price Tracker</title>

    <style>
        :root{
            --bg:#f6f7f9;
            --card:#ffffffcc;
            --text:#111;
            --muted:#666;
            --border:#e8e8e8;
            --accent:#111;
        }

        @media (prefers-color-scheme:dark){
            :root{
                --bg:#0e0e11;
                --card:#1a1a1dcc;
                --text:#f5f5f7;
                --muted:#9a9aa1;
                --border:#2a2a2e;
                --accent:#fff;
            }
        }

        body{
            margin:0;
            font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Arial;
            background:var(--bg);
            color:var(--text);
            overflow-x: hidden;
        }

        header{
            backdrop-filter:blur(12px);
            background:rgba(255,255,255,.6);
            border-bottom:1px solid var(--border);
            padding:26px 20px;
            position:sticky;
            top:0;
        }

        @media(prefers-color-scheme:dark){
            header{background:rgba(20,20,24,.7);}
        }

        h1{margin:0 0 14px;}

        #search{
            width:100%;
            padding:14px 16px;
            border-radius:12px;
            border:1px solid var(--border);
            background:var(--card);
            color:var(--text);
        }

        .container{
            max-width:1100px;
            margin:50px auto;
            padding:0 18px;
        }

        .grid{
            display:grid;
            gap:22px;
            grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
        }

        .card{
            background:var(--card);
            backdrop-filter:blur(16px);
            border:1px solid var(--border);
            border-radius:16px;
            padding:22px;
            animation:fade .5s ease;
            transition:.25s;
        }

        .card:hover{
            transform:translateY(-6px);
            box-shadow:0 12px 40px rgba(0,0,0,.12);
        }

        @keyframes fade{
            from{opacity:0;transform:translateY(10px);}
            to{opacity:1;transform:translateY(0);}
        }

        .best{
            background:linear-gradient(145deg,#fafafa,#f2f2f2);
            border:1px solid var(--border);
            padding:14px;
            border-radius:14px;
            margin-bottom:14px;
            font-size:14px;
            position:relative;
        }

        @media(prefers-color-scheme:dark){
            .best{background:linear-gradient(145deg,#1f1f23,#18181b);}
        }

        .best::after{
            content:"";
            position:absolute;
            inset:0;
            border-radius:14px;
            box-shadow:0 0 18px rgba(0,255,170,.25);
            opacity:.6;
        }

        .size-tabs{
            display:flex;
            gap:8px;
            flex-wrap:wrap;
            margin-bottom:14px;
        }

        .tab{
            padding:7px 12px;
            border-radius:999px;
            border:1px solid var(--border);
            font-size:12px;
            cursor:pointer;
            color:var(--muted);
        }

        .tab.active{
            background:var(--accent);
            color:var(--bg);
        }

        .vendor{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:12px 0;
            border-top:1px solid var(--border);
            animation:fade .3s ease;
        }

        .vendor-left{
            display:flex;
            gap:12px;
            align-items:center;
        }

        .vendor img{
            width:38px;
            height:38px;
            border-radius:10px;
            border:1px solid var(--border);
            background:white;
            object-fit:contain;
        }

        .vname{font-weight:600;font-size:14px;}
        .price{font-size:13px;color:var(--muted);}

        .actions{
            display:flex;
            gap:8px;
        }

        button,a{
            padding:8px 12px;
            border-radius:999px;
            border:1px solid var(--border);
            font-size:12px;
            text-decoration:none;
            background:transparent;
            color:var(--text);
            cursor:pointer;
        }

        .shop{
            background:var(--accent);
            color:var(--bg);
        }

        .note-btn{
            font-size:11px;
            opacity:.7;
        }

        footer{
            text-align:center;
            color:var(--muted);
            padding:50px 20px;
            font-size:13px;
        }
    </style>
</head>

<body>

<header>
    <h1>Peptide Price Tracker</h1>
    <input id="search" placeholder="Search peptides...">
</header>

<div class="container">
    <div id="grid" class="grid"></div>
</div>

<footer>
    Auto-updated pricing • Research purposes only
</footer>

<script>
    let DATA;

    async function load(){
        const r=await fetch("data.json?"+Date.now());
        DATA=await r.json();
        render();
    }

    setInterval(load,300000);

    function copy(t){
        navigator.clipboard.writeText(t);
        alert("Copied code: "+t);
    }

    function showNote(n){
        alert(n);
    }

    function sizes(vs){
        const s=new Set();
        vs.forEach(v=>Object.keys(v.sizes).forEach(x=>s.add(x)));
        return [...s];
    }

    function cheapest(vs){
        let b=null;
        vs.forEach(v=>{
            Object.entries(v.sizes).forEach(([s,d])=>{
                if(!b||d.pricePerML<b.price)
                    b={name:v.name,size:s,price:d.pricePerML,url:v.url,note:d.note};
            });
        });
        return b;
    }

    function forSize(vs,size){
        return vs.filter(v=>v.sizes[size])
            .map(v=>({
                name:v.name,
                price:v.sizes[size].pricePerML,
                url:v.url,
                note:v.sizes[size].note
            }))
            .sort((a,b)=>a.price-b.price);
    }

    function render(){
        const grid=document.getElementById("grid");
        grid.innerHTML="";
        const q=document.getElementById("search").value.toLowerCase();

        Object.entries(DATA.peptides).forEach(([pep,vs])=>{
            if(!pep.toLowerCase().includes(q))return;

            const card=document.createElement("div");
            card.className="card";
            card.innerHTML=`<h2>${pep}</h2>`;

            const best=cheapest(vs);
            const ic=DATA.icons[best.name.replace(/\s/g,"")];

            const bestBox=document.createElement("div");
            bestBox.className="best";
            bestBox.innerHTML=`
      <strong>Best Price</strong><br>
      ${best.name} · ${best.size} · $${best.price}/mL
      <div class="actions" style="margin-top:10px;">
        <a class="shop" href="${best.url}" target="_blank">Shop</a>
        <button onclick="copy('${ic?.affiliateCode||""}')">
          ${ic?.affiliateCode||""} · ${ic?.discount||""}
        </button>
        ${best.note ? `<button class="note-btn" onclick="showNote('${best.note}')">Note</button>`:""}
      </div>`;
            card.appendChild(bestBox);

            const ss=sizes(vs);
            let active=ss[0];

            const tabs=document.createElement("div");
            tabs.className="size-tabs";

            const box=document.createElement("div");

            function draw(){
                box.innerHTML="";
                forSize(vs,active).forEach(v=>{
                    const i=DATA.icons[v.name.replace(/\s/g,"")];
                    const row=document.createElement("div");
                    row.className="vendor";
                    row.innerHTML=`
          <div class="vendor-left">
            <img src="${i?.url||""}">
            <div>
              <div class="vname">${v.name}</div>
              <div class="price">$${v.price}/mL</div>
            </div>
          </div>
          <div class="actions">
            <button onclick="copy('${i?.affiliateCode||""}')">
              ${i?.affiliateCode||""} · ${i?.discount||""}
            </button>
            <a class="shop" href="${v.url}" target="_blank">Shop</a>
            ${v.note ? `<button class="note-btn" onclick="showNote('${v.note}')">Note</button>`:""}
          </div>`;
                    box.appendChild(row);
                });
            }

            ss.forEach(s=>{
                const t=document.createElement("div");
                t.className="tab"+(s===active?" active":"");
                t.textContent=s;
                t.onclick=()=>{
                    active=s;
                    [...tabs.children].forEach(c=>c.classList.remove("active"));
                    t.classList.add("active");
                    draw();
                };
                tabs.appendChild(t);
            });

            card.appendChild(tabs);
            card.appendChild(box);
            draw();

            grid.appendChild(card);
        });
    }

    document.getElementById("search").addEventListener("input",render);
    load();
</script>

</body>
</html>
